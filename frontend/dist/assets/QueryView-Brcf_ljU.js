import{M as Y}from"./MonacoEditor-BkwIVYFS.js";import{p as z,q as Q}from"./index-CEDoj4eB.js";import{_ as M,r as d,c as N,a as C,b as t,w as a,e as l,o as f,i as x,f as r,t as R,g as S,j as s}from"./index-DIi-ZwBs.js";const U={class:"query-view"},j={key:0,style:{"margin-left":"12px",color:"#52c41a"}},L={key:0},$=`// 猫的结构体定义
struct 猫 {
    char* ID;
    char* 名字;
    char* 品种;
    int 出生日期;
    char* 颜色;
};

// 园区的猫数据
猫 园区的猫们[] = {
    {"CAT001", "小黄", "橘猫", 2023, "黄色"},
    {"CAT002", "小黑", "狸花", 2024, "灰色"},
    {"CAT003", "小白", "波斯", 2022, "白色"},
    {"CAT004", "花花", "狸花", 2023, "花色"},
    {"CAT005", "咪咪", "暹罗", 2024, "奶油色"},
    {"CAT006", "大橘", "橘猫", 2021, "黄色"},
    {"CAT007", "小灰", "英短", 2023, "灰色"}
};
`,F={__name:"QueryView",setup(G){const p=d(""),c=d(""),u=d(""),n=d(null),v=d(!1),y=d(!1),H=N(()=>{var o;return(o=n.value)!=null&&o.columns?n.value.columns.filter(e=>!e.startsWith("_")).map(e=>({title:e,dataIndex:e,key:e})):[]});function w(){p.value=$,u.value="",n.value=null}function k({key:o}){const e={1:"SEARCH 园区的猫们",2:"SEARCH 园区的猫们 WHERE 品种 = '狸花'",3:"SEARCH 园区的猫们 WHERE 出生日期 > 2022",4:"SEARCH 园区的猫们 ORDER BY 出生日期 DESC",5:"SEARCH 园区的猫们 WHERE 品种 = '橘猫' ORDER BY 出生日期"};c.value=e[o]||""}async function D(){if(!p.value.trim()){s.warning("请先输入数据源代码");return}v.value=!0;try{const o=await z.parseContent(p.value,"query.c");o.code===200?(u.value=o.data.fileId,s.success("数据源解析成功")):s.error(o.message||"解析失败")}catch{s.error("解析失败")}finally{v.value=!1}}async function b(){if(!c.value.trim()){s.warning("请输入查询语句");return}if(!u.value){s.warning("请先解析数据源");return}y.value=!0;try{const o=await Q.execute(c.value,[u.value]);o.code===200?(n.value=o.data,s.success(`查询完成，共 ${o.data.totalCount} 条结果`)):s.error(o.message||"查询失败")}catch{s.error("查询失败")}finally{y.value=!1}}return(o,e)=>{const _=l("a-button"),E=l("a-card"),g=l("a-col"),m=l("a-menu-item"),T=l("a-menu"),W=l("a-dropdown"),q=l("a-textarea"),B=l("a-alert"),V=l("a-row"),I=l("a-table"),O=l("a-empty");return f(),C("div",U,[t(V,{gutter:16},{default:a(()=>[t(g,{span:12},{default:a(()=>[t(E,{title:"数据源",bordered:!1},{extra:a(()=>[t(_,{onClick:w,size:"small"},{default:a(()=>[...e[2]||(e[2]=[r("加载示例",-1)])]),_:1})]),default:a(()=>[t(Y,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=i=>p.value=i),language:"c",height:"300px",readOnly:!1},null,8,["modelValue"]),t(_,{type:"primary",style:{"margin-top":"12px"},onClick:D,loading:v.value},{default:a(()=>[...e[3]||(e[3]=[r(" 解析数据源 ",-1)])]),_:1},8,["loading"]),u.value?(f(),C("span",j," 已解析 ("+R(u.value)+") ",1)):x("",!0)]),_:1})]),_:1}),t(g,{span:12},{default:a(()=>[t(E,{title:"查询语句",bordered:!1},{extra:a(()=>[t(W,null,{overlay:a(()=>[t(T,{onClick:k},{default:a(()=>[t(m,{key:"1"},{default:a(()=>[...e[5]||(e[5]=[r("SEARCH 园区的猫们",-1)])]),_:1}),t(m,{key:"2"},{default:a(()=>[...e[6]||(e[6]=[r("SEARCH 园区的猫们 WHERE 品种 = '狸花'",-1)])]),_:1}),t(m,{key:"3"},{default:a(()=>[...e[7]||(e[7]=[r("SEARCH 园区的猫们 WHERE 出生日期 > 2022",-1)])]),_:1}),t(m,{key:"4"},{default:a(()=>[...e[8]||(e[8]=[r("SEARCH 园区的猫们 ORDER BY 出生日期 DESC",-1)])]),_:1}),t(m,{key:"5"},{default:a(()=>[...e[9]||(e[9]=[r("SEARCH 园区的猫们 WHERE 品种 = '橘猫' ORDER BY 出生日期",-1)])]),_:1})]),_:1})]),default:a(()=>[t(_,{size:"small"},{default:a(()=>[...e[4]||(e[4]=[r("示例查询",-1)])]),_:1})]),_:1})]),default:a(()=>[t(q,{value:c.value,"onUpdate:value":e[1]||(e[1]=i=>c.value=i),placeholder:"输入查询语句，例如: SEARCH 园区的猫们 WHERE 品种 = '狸花'",rows:4},null,8,["value"]),t(B,{style:{"margin-top":"12px"},type:"info","show-icon":"",message:"查询语法",description:"SEARCH 变量名 [WHERE 条件] [ORDER BY 字段 [ASC|DESC]] [LIMIT 数量]"}),t(_,{type:"primary",style:{"margin-top":"12px"},onClick:b,loading:y.value,disabled:!u.value},{default:a(()=>[...e[10]||(e[10]=[r(" 执行查询 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1}),t(E,{title:"查询结果",bordered:!1,style:{"margin-top":"16px"}},{extra:a(()=>[n.value?(f(),C("span",L," 共 "+R(n.value.totalCount)+" 条记录，耗时 "+R(n.value.executionTime)+"ms ",1)):x("",!0)]),default:a(()=>{var i,A;return[(A=(i=n.value)==null?void 0:i.rows)!=null&&A.length?(f(),S(I,{key:0,columns:H.value,"data-source":n.value.rows,pagination:{pageSize:10},size:"small",scroll:{x:800}},null,8,["columns","data-source"])):(f(),S(O,{key:1,description:"暂无查询结果"}))]}),_:1})])}}},X=M(F,[["__scopeId","data-v-33fccf42"]]);export{X as default};
