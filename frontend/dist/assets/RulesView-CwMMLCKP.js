import{r as D}from"./index-CEDoj4eB.js";import{_ as Z,r as d,k as h,l as ee,j as v,a as ae,b as a,w as t,e as r,o as m,g as y,i as _,f as o,t as E,m as te}from"./index-DIi-ZwBs.js";const le={class:"rules-view"},ue={__name:"RulesView",setup(ne){const T=d(!1),V=d([]),k=d(!1),b=d(null),l=d({name:"",description:"",targetVariable:"",targetField:"",ruleType:"unique",dslContent:"",severity:"ERROR"}),I=d(">"),C=d(""),w=d(""),R=d(""),A=[{title:"ID",dataIndex:"id",key:"id",width:60},{title:"规则名称",dataIndex:"name",key:"name"},{title:"DSL内容",dataIndex:"dslContent",key:"dslContent",ellipsis:!0},{title:"状态",key:"status",width:100},{title:"严重程度",key:"severity",width:100},{title:"操作",key:"action",width:180}];h(()=>{$()}),ee([()=>l.value.targetVariable,()=>l.value.targetField,()=>l.value.ruleType],()=>{x()});async function $(){T.value=!0;try{const n=await D.list();n.code===200&&(V.value=n.data)}catch{v.error("加载规则失败")}finally{T.value=!1}}function B(){b.value=null,l.value={name:"",description:"",targetVariable:"",targetField:"",ruleType:"unique",dslContent:"",severity:"ERROR"},I.value=">",C.value="",w.value="",R.value="",k.value=!0}function L(n){b.value=n,l.value={...n},k.value=!0}function x(){const{targetVariable:n,targetField:e,ruleType:g}=l.value;if(!n||!e)return;let p="";switch(g){case"unique":p=`${n} ${e} 不重复`;break;case"compare":C.value&&(p=`${n} ${e} ${I.value} ${C.value}`);break;case"in":w.value&&(p=`${n} ${e} IN (${w.value})`);break;case"match":R.value&&(p=`${n} ${e} MATCH ${R.value}`);break}l.value.dslContent=p}async function O(){if(!l.value.name||!l.value.dslContent){v.warning("请填写规则名称和DSL内容");return}try{b.value?(await D.update(b.value.id,l.value),v.success("规则更新成功")):(await D.create(l.value),v.success("规则创建成功")),k.value=!1,$()}catch{v.error("保存失败")}}async function q(n){try{await D.publish(n.id),v.success("规则发布成功"),$()}catch{v.error("发布失败")}}async function z(n){try{await D.delete(n.id),v.success("规则删除成功"),$()}catch{v.error("删除失败")}}function H(n){switch(n){case"PUBLISHED":return"green";case"DRAFT":return"orange";case"DISABLED":return"default";default:return"default"}}function P(n){switch(n){case"PUBLISHED":return"已发布";case"DRAFT":return"草稿";case"DISABLED":return"已禁用";default:return n}}function M(n){switch(n){case"ERROR":return"red";case"WARNING":return"orange";case"INFO":return"blue";default:return"default"}}return(n,e)=>{const g=r("a-button"),p=r("a-tag"),G=r("a-popconfirm"),W=r("a-space"),j=r("a-table"),J=r("a-card"),c=r("a-input"),s=r("a-form-item"),S=r("a-textarea"),i=r("a-select-option"),N=r("a-select"),K=r("a-input-group"),U=r("a-radio"),Q=r("a-radio-group"),X=r("a-form"),Y=r("a-modal");return m(),ae("div",le,[a(J,{title:"规则管理",bordered:!1},{extra:t(()=>[a(g,{type:"primary",onClick:B},{default:t(()=>[...e[12]||(e[12]=[o(" 新建规则 ",-1)])]),_:1})]),default:t(()=>[a(j,{columns:A,"data-source":V.value,loading:T.value,pagination:{pageSize:10},"row-key":"id"},{bodyCell:t(({column:u,record:f})=>[u.key==="status"?(m(),y(p,{key:0,color:H(f.status)},{default:t(()=>[o(E(P(f.status)),1)]),_:2},1032,["color"])):_("",!0),u.key==="severity"?(m(),y(p,{key:1,color:M(f.severity)},{default:t(()=>[o(E(f.severity),1)]),_:2},1032,["color"])):_("",!0),u.key==="action"?(m(),y(W,{key:2},{default:t(()=>[a(g,{type:"link",size:"small",onClick:F=>L(f)},{default:t(()=>[...e[13]||(e[13]=[o(" 编辑 ",-1)])]),_:1},8,["onClick"]),f.status!=="PUBLISHED"?(m(),y(g,{key:0,type:"link",size:"small",onClick:F=>q(f)},{default:t(()=>[...e[14]||(e[14]=[o(" 发布 ",-1)])]),_:1},8,["onClick"])):_("",!0),a(G,{title:"确定删除此规则?",onConfirm:F=>z(f)},{default:t(()=>[a(g,{type:"link",size:"small",danger:""},{default:t(()=>[...e[15]||(e[15]=[o("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):_("",!0)]),_:1},8,["data-source","loading"])]),_:1}),a(Y,{open:k.value,"onUpdate:open":e[11]||(e[11]=u=>k.value=u),title:b.value?"编辑规则":"新建规则",onOk:O,width:"600px"},{default:t(()=>[a(X,{model:l.value,layout:"vertical"},{default:t(()=>[a(s,{label:"规则名称",required:""},{default:t(()=>[a(c,{value:l.value.name,"onUpdate:value":e[0]||(e[0]=u=>l.value.name=u),placeholder:"请输入规则名称"},null,8,["value"])]),_:1}),a(s,{label:"规则描述"},{default:t(()=>[a(S,{value:l.value.description,"onUpdate:value":e[1]||(e[1]=u=>l.value.description=u),placeholder:"请输入规则描述",rows:2},null,8,["value"])]),_:1}),a(s,{label:"目标变量"},{default:t(()=>[a(c,{value:l.value.targetVariable,"onUpdate:value":e[2]||(e[2]=u=>l.value.targetVariable=u),placeholder:"例如: 园区的猫们"},null,8,["value"])]),_:1}),a(s,{label:"目标字段"},{default:t(()=>[a(c,{value:l.value.targetField,"onUpdate:value":e[3]||(e[3]=u=>l.value.targetField=u),placeholder:"例如: ID"},null,8,["value"])]),_:1}),a(s,{label:"规则类型"},{default:t(()=>[a(N,{value:l.value.ruleType,"onUpdate:value":e[4]||(e[4]=u=>l.value.ruleType=u),onChange:x},{default:t(()=>[a(i,{value:"unique"},{default:t(()=>[...e[16]||(e[16]=[o("唯一性检查",-1)])]),_:1}),a(i,{value:"compare"},{default:t(()=>[...e[17]||(e[17]=[o("范围检查",-1)])]),_:1}),a(i,{value:"in"},{default:t(()=>[...e[18]||(e[18]=[o("枚举检查",-1)])]),_:1}),a(i,{value:"match"},{default:t(()=>[...e[19]||(e[19]=[o("正则匹配",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l.value.ruleType==="compare"?(m(),y(s,{key:0,label:"比较条件"},{default:t(()=>[a(K,{compact:""},{default:t(()=>[a(N,{value:I.value,"onUpdate:value":e[5]||(e[5]=u=>I.value=u),style:{width:"80px"}},{default:t(()=>[a(i,{value:">"},{default:t(()=>[...e[20]||(e[20]=[o(">",-1)])]),_:1}),a(i,{value:"<"},{default:t(()=>[...e[21]||(e[21]=[o("<",-1)])]),_:1}),a(i,{value:">="},{default:t(()=>[...e[22]||(e[22]=[o("=",-1)])]),_:1}),a(i,{value:"<="},{default:t(()=>[...e[23]||(e[23]=[o("<=",-1)])]),_:1}),a(i,{value:"="},{default:t(()=>[...e[24]||(e[24]=[o("=",-1)])]),_:1})]),_:1},8,["value"]),a(c,{value:C.value,"onUpdate:value":e[6]||(e[6]=u=>C.value=u),style:{width:"calc(100% - 80px)"},placeholder:"比较值",onChange:x},null,8,["value"])]),_:1})]),_:1})):_("",!0),l.value.ruleType==="in"?(m(),y(s,{key:1,label:"允许值列表"},{default:t(()=>[a(c,{value:w.value,"onUpdate:value":e[7]||(e[7]=u=>w.value=u),placeholder:"用逗号分隔，例如: 黄色, 黑色, 白色",onChange:x},null,8,["value"])]),_:1})):_("",!0),l.value.ruleType==="match"?(m(),y(s,{key:2,label:"正则表达式"},{default:t(()=>[a(c,{value:R.value,"onUpdate:value":e[8]||(e[8]=u=>R.value=u),placeholder:"例如: ^CAT\\\\d+$",onChange:x},null,8,["value"])]),_:1})):_("",!0),a(s,{label:"严重程度"},{default:t(()=>[a(Q,{value:l.value.severity,"onUpdate:value":e[9]||(e[9]=u=>l.value.severity=u)},{default:t(()=>[a(U,{value:"ERROR"},{default:t(()=>[...e[25]||(e[25]=[o("错误",-1)])]),_:1}),a(U,{value:"WARNING"},{default:t(()=>[...e[26]||(e[26]=[o("警告",-1)])]),_:1}),a(U,{value:"INFO"},{default:t(()=>[...e[27]||(e[27]=[o("提示",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(s,{label:"规则DSL",required:""},{default:t(()=>[a(S,{value:l.value.dslContent,"onUpdate:value":e[10]||(e[10]=u=>l.value.dslContent=u),placeholder:"规则DSL语句",rows:3},null,8,["value"]),e[28]||(e[28]=te("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 语法示例: 变量 字段 不重复 | 变量 字段 > 值 | 变量 字段 IN (值1, 值2) ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},se=Z(ue,[["__scopeId","data-v-1954f12a"]]);export{se as default};
